<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="description"
        content="Danmarks Tekniske Museum AR Experience - Explore aviation history with augmented reality">
    <title>Danmarks Tekniske Museum - AR Experience</title>

    <!-- Preconnect for fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Import Maps Polyfill -->
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

    <!-- Import Map for Three.js -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Expose THREE to window for app.js -->
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';
        window.THREE = THREE;
        window.THREE.GLTFLoader = GLTFLoader;
        console.log('THREE and GLTFLoader exposed via direct URL');
    </script>




    <!-- MindAR Three.js Integration (ES Module) -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"></script>



    <!-- QR Scanner -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>



    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- ===== HOME SCREEN ===== -->
    <div id="home-screen" class="screen active">
        <div class="home-hero">
            <!-- Mascot Image (Adjust 'top' and 'right' in style.css or inline to move) -->
            <img src="./assets/images/Lyn07.png" class="mascot-image" alt="Mascot">

            <div class="logo-container">
                <img src="./assets/images/logo.png" alt="Danmarks Tekniske Museum" id="museum-logo">
            </div>
            <h1 class="home-title">Build, explore and create !</h1>
            <div class="emoji-banner">
                <span>üöó</span>
                <span>üöÅ</span>
                <span>‚úàÔ∏è</span>
            </div>
        </div>

        <div class="mission-grid container">
            <div class="grid-2">
                <!-- Build Plane Card -->
                <button class="mission-card blue" onclick="navigateTo('instructions')">
                    <div class="mission-card-decoration"></div>
                    <div class="mission-card-icon">‚úàÔ∏è</div>
                    <div>
                        <div class="mission-card-title">Build Plane</div>
                        <div class="mission-card-subtitle">Fold your jet!</div>
                    </div>
                </button>

                <!-- AR Scanner Card -->
                <button class="mission-card emerald" onclick="navigateTo('ar')" id="ar-card">
                    <div class="mission-card-decoration"></div>
                    <div class="mission-card-icon">üì±</div>
                    <div>
                        <div class="mission-card-title">Upgrade your paperplane</div>
                        <div class="mission-card-subtitle">Add digital features from the collection</div>
                    </div>
                </button>

                <!-- Start Mission Card -->
                <button class="mission-card orange grid-full" onclick="navigateTo('route')">
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="mission-card-icon" style="margin-bottom: 0;">üó∫Ô∏è</div>
                            <div>
                                <div class="mission-card-title">Start Mission</div>
                                <div class="mission-card-subtitle">Visit the collection and gather features for your
                                    paperplane</div>
                            </div>
                        </div>
                        <span style="font-size: 2.5rem;">‚Üí</span>
                    </div>
                </button>

                <!-- My Hangar Card -->
                <button class="mission-card violet grid-full" onclick="navigateTo('collection')">
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="mission-card-icon" style="margin-bottom: 0;">‚≠ê</div>
                            <div>
                                <div class="mission-card-title">My Hangar</div>
                                <div class="mission-card-subtitle" id="collection-count">0 Items Collected</div>
                            </div>
                        </div>
                        <div class="collection-preview" id="collection-preview">
                            <span class="collection-badge locked">?</span>
                            <span class="collection-badge locked">?</span>
                            <span class="collection-badge locked">?</span>
                        </div>
                    </div>
                </button>
            </div>
        </div>

        <div class="pro-tip">
            <span class="pro-tip-icon">üí°</span>
            <p class="pro-tip-text">
                <strong>Pro Pilot Tip:</strong> Scan QR codes around the museum to unlock 3D models and sounds for your
                AR experience!
            </p>
        </div>
    </div>

    <!-- ===== INSTRUCTIONS SCREEN ===== -->
    <div id="instructions-screen" class="screen">
        <header class="header">
            <div class="header-content">
                <button class="btn btn-ghost btn-icon" onclick="navigateTo('home')">‚Üê</button>
                <div>
                    <h1 class="header-title">Paper Plane Instructions</h1>
                    <p class="header-subtitle">Create your AR-enabled paper plane</p>
                </div>
            </div>
        </header>

        <div class="design-selector">
            <button class="design-option active" onclick="selectDesign('dart', this)">Classic Dart</button>
            <button class="design-option" onclick="selectDesign('glider', this)">The Glider</button>
        </div>

        <div class="instruction-steps" id="instruction-steps">
            <!-- Steps populated by JavaScript -->
        </div>

        <div class="tips-card">
            <div class="tips-title">üí° Pro Tips</div>
            <ul class="tips-list">
                <li>Make crisp, clean folds for better flight performance</li>
                <li>Test your plane before scanning - it should glide smoothly</li>
                <li>The AR scanner works better with high-contrast patterns</li>
            </ul>
        </div>

        <div style="padding: 16px;">
            <button class="btn btn-green btn-lg btn-full" onclick="navigateTo('home')">
                ‚úì I've Created My Plane!
            </button>
        </div>
    </div>

    <!-- ===== AR VIEW SCREEN ===== -->
    <div id="ar-screen" class="screen">
        <div class="ar-container" id="ar-container"></div>

        <div class="ar-overlay">
            <!-- Back Button -->
            <button class="btn btn-ghost btn-icon ar-back-btn" onclick="stopAR(); navigateTo('home')"
                style="background: rgba(255,255,255,0.9);">‚Üê</button>

            <!-- Star Counter -->
            <div class="star-counter">
                <span class="star-counter-icon">‚≠ê</span>
                <span class="star-counter-value" id="ar-star-count">0</span>
            </div>

            <!-- AR Features Menu (Consolidated) -->
            <div class="ar-features-menu" id="ar-features-menu">
                <div class="model-selector" id="model-selector">
                    <!-- Populated by JavaScript -->
                </div>

                <!-- Feature Name Display -->
                <div id="feature-name-display" class="feature-name-display">Select an item</div>

                <div class="menu-divider">
                    <span>‚ö°</span>
                </div>

                <div class="sound-controls" id="sound-controls">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- AR Status -->
            <div class="ar-status" id="ar-status">
                <span class="ar-status-dot"></span>
                <span>Point camera at marker</span>
            </div>
        </div>

        <!-- Error Overlay -->
        <div class="error-overlay hidden" id="ar-error">
            <div class="error-icon">üì∑</div>
            <div class="error-title">Camera Error</div>
            <p class="error-message" id="ar-error-message">Could not start camera. Please ensure you're using HTTPS and
                have granted camera permissions.</p>
            <button class="btn btn-primary" style="margin-top: 24px;" onclick="navigateTo('home')">Go Back</button>
        </div>
    </div>

    <!-- ===== SCANNER SCREEN ===== -->
    <div id="scanner-screen" class="screen">
        <header class="header" style="background: rgba(0,0,0,0.7); border: none;">
            <div class="header-content">
                <button class="btn btn-ghost btn-icon" onclick="stopScanner(); navigateTo('home')"
                    style="color: white;">‚Üê</button>
                <div>
                    <h1 class="header-title" style="color: white;">Feature Scanner</h1>
                    <p class="header-subtitle" style="color: rgba(255,255,255,0.7);">Scan QR codes to unlock</p>
                </div>
            </div>
        </header>

        <div id="scanner-view" style="width: 100%; height: calc(100vh - 80px); background: black;"></div>

        <div
            style="position: absolute; bottom: 80px; left: 0; right: 0; text-align: center; color: rgba(255,255,255,0.8); pointer-events: none;">
            Point camera at a Feature QR Code
        </div>

        <!-- Scan Result Modal -->
        <div class="modal-overlay" id="scan-result-modal">
            <div class="modal-content">
                <div class="modal-body" style="text-align: center; padding: 32px;">
                    <div id="scan-result-icon" style="font-size: 4rem; margin-bottom: 16px;">‚úÖ</div>
                    <h2 id="scan-result-title" style="margin-bottom: 8px;">Feature Unlocked!</h2>
                    <p id="scan-result-message" style="color: var(--color-muted-foreground); margin-bottom: 24px;">
                        You've collected a new item!</p>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-green btn-full" onclick="closeScanResult(); navigateTo('ar')">Try it in
                            AR!</button>
                        <button class="btn btn-secondary btn-full" onclick="closeScanResult()">Scan Another</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== COLLECTION SCREEN ===== -->
    <div id="collection-screen" class="screen">
        <header class="header">
            <div class="header-content">
                <button class="btn btn-ghost btn-icon" onclick="navigateTo('home')">‚Üê</button>
                <div style="flex: 1;">
                    <h1 class="header-title">üé® Collection</h1>
                </div>
                <button class="btn btn-primary btn-icon" onclick="navigateTo('scanner')"
                    style="width: auto; padding: 8px 16px; border-radius: var(--radius);">
                    üì∑ Scan
                </button>
            </div>
        </header>

        <div class="stats-card">
            <div class="stats-content">
                <div class="stats-label">Your Collection</div>
                <div class="stats-value" id="stats-collected">0 / 8</div>
                <div class="stats-progress" id="stats-progress">0% Complete</div>
            </div>
            <div class="stats-icon">üèÜ</div>
        </div>

        <div class="collection-grid" id="collection-grid">
            <!-- Feature cards populated by JavaScript -->
        </div>
    </div>

    <!-- ===== ROUTE MAP SCREEN ===== -->
    <div id="route-screen" class="screen">
        <header class="header">
            <div class="header-content">
                <button class="btn btn-ghost btn-icon" onclick="navigateTo('home')">‚Üê</button>
                <div>
                    <h1 class="header-title">üìç Aviation Hall Route</h1>
                </div>
            </div>
        </header>

        <div class="progress-card">
            <div class="progress-header">
                <span class="progress-title">Route Progress</span>
                <span class="progress-value" id="route-progress-value">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="route-progress-fill" style="width: 0%;"></div>
            </div>
        </div>

        <div class="map-container">
            <div class="map-visual">
                <svg width="100%" height="100%" viewBox="0 0 300 150">
                    <!-- Grid -->
                    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                        <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e2e8f0" stroke-width="0.5" />
                    </pattern>
                    <rect width="100%" height="100%" fill="url(#grid)" />

                    <!-- Route Path -->
                    <path d="M 30 75 Q 100 30, 150 75 T 270 75" fill="none" stroke="#ea580c" stroke-width="3"
                        stroke-dasharray="8,4" class="animate-pulse" />

                    <!-- Waypoint dots -->
                    <circle cx="30" cy="75" r="8" fill="#ea580c" />
                    <circle cx="100" cy="45" r="6" fill="#ea580c" opacity="0.6" />
                    <circle cx="150" cy="75" r="6" fill="#ea580c" opacity="0.6" />
                    <circle cx="200" cy="55" r="6" fill="#ea580c" opacity="0.6" />
                    <circle cx="270" cy="75" r="8" fill="#16a34a" />

                    <!-- Labels -->
                    <text x="30" y="100" text-anchor="middle" font-size="10" fill="#64748b">Start</text>
                    <text x="270" y="100" text-anchor="middle" font-size="10" fill="#64748b">Finish</text>
                </svg>
            </div>
        </div>

        <div class="waypoints-list" id="waypoints-list">
            <div class="waypoints-line"></div>
            <!-- Waypoints populated by JavaScript -->
        </div>
    </div>

    <!-- ===== FLOATING MENU ===== -->
    <div class="floating-menu" id="floating-menu">
        <div class="fab-menu" id="fab-menu">
            <div class="fab-item">
                <span class="fab-item-label">Instructions</span>
                <button class="fab-item-btn" onclick="toggleFabMenu(); navigateTo('instructions')">üìã</button>
            </div>
            <div class="fab-item">
                <span class="fab-item-label">Scanner</span>
                <button class="fab-item-btn" onclick="toggleFabMenu(); navigateTo('scanner')">üì∑</button>
            </div>
            <div class="fab-item">
                <span class="fab-item-label">AR View</span>
                <button class="fab-item-btn" onclick="toggleFabMenu(); navigateTo('ar')">üéØ</button>
            </div>
            <div class="fab-item">
                <span class="fab-item-label">Route Map</span>
                <button class="fab-item-btn" onclick="toggleFabMenu(); navigateTo('route')">üó∫Ô∏è</button>
            </div>
            <div class="fab-item">
                <span class="fab-item-label">Collection</span>
                <button class="fab-item-btn" onclick="toggleFabMenu(); navigateTo('collection')">‚≠ê</button>
            </div>
        </div>
        <button class="fab-btn" id="fab-btn" onclick="toggleFabMenu()">
            <span class="icon-menu">‚ò∞</span>
            <span class="icon-close">‚úï</span>
        </button>
    </div>

    <!-- ===== LOADING OVERLAY ===== -->
    <div class="loading-overlay hidden" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Loading...</div>
    </div>

    <!-- Main Application Script -->
    <script src="app.js"></script>
</body>

</html>